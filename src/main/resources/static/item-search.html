<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ìƒí’ˆ ëª©ë¡ - Cloud Shop</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">
        <div class="container">
            <a class="navbar-brand fw-bold" href="/"><i class="bi bi-shop"></i> Cloud Shop</a>
             </div>
    </nav>

    <div class="container mt-5">
        <h2 class="fw-bold mb-4" id="page-title">
            ìƒí’ˆ ëª©ë¡
        </h2>

        <div id="search-result-list" class="row row-cols-1 row-cols-md-3 row-cols-lg-4 g-4">
            </div>
        
        <div id="no-result" class="text-center py-5 d-none">
            <i class="bi bi-exclamation-circle fs-1 text-secondary"></i>
            <p class="mt-3 text-secondary fs-5">ë“±ë¡ëœ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>
            <a href="/" class="btn btn-outline-dark mt-2">ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            // 1. URL íŒŒë¼ë¯¸í„° ë¶„ì„ (ê²€ìƒ‰ì–´? ì¹´í…Œê³ ë¦¬? ì „ì²´?)
            const params = new URLSearchParams(window.location.search);
            const keyword = params.get('keyword');
            const categoryId = params.get('categoryId');
            const categoryName = params.get('categoryName');

            // 2. ìƒí™©ë³„ API í˜¸ì¶œ ë¶„ê¸°
            if (keyword) {
                // [CASE 1] ê²€ìƒ‰ ëª¨ë“œ
                document.getElementById('page-title').innerHTML = `ğŸ” "<span class="text-primary">${keyword}</span>" ê²€ìƒ‰ ê²°ê³¼`;
                loadItems(`/api/items/search?keyword=${encodeURIComponent(keyword)}&size=20`);
            } 
            else if (categoryId) {
                // [CASE 2] ì¹´í…Œê³ ë¦¬ ëª¨ë“œ
                // ì œëª© ì„¤ì • (categoryNameì´ ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ ì¶œë ¥)
                const title = categoryName ? categoryName : "ì¹´í…Œê³ ë¦¬ ìƒí’ˆ";
                document.getElementById('page-title').innerText = `ğŸ“‚ ${title}`;
                
                // ì¹´í…Œê³ ë¦¬ë³„ ì¡°íšŒ API í˜¸ì¶œ
                loadItems(`/api/items?categoryId=${categoryId}&page=0&size=20`);
            } 
            else {
                // [CASE 3] ì „ì²´ ë³´ê¸° ëª¨ë“œ (íŒŒë¼ë¯¸í„°ê°€ ì•„ë¬´ê²ƒë„ ì—†ì„ ë•Œ)
                document.getElementById('page-title').innerText = "ğŸ”¥ ì „ì²´ ìƒí’ˆ ëª©ë¡";
                loadItems(`/api/items?page=0&size=20`);
            }
        });

        // 3. ìƒí’ˆ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° (ê³µí†µ í•¨ìˆ˜)
        function loadItems(apiUrl) {
            fetch(apiUrl)
                .then(res => {
                    if(!res.ok) throw new Error("API Load Failed");
                    return res.json();
                })
                .then(data => {
                    const container = document.getElementById('search-result-list');
                    container.innerHTML = ""; // ì´ˆê¸°í™”
                    
                    const items = data.content; // Page<ItemResponseDTO>ì˜ content

                    if (items.length === 0) {
                        document.getElementById('no-result').classList.remove('d-none');
                        return;
                    }

                    // ì¹´ë“œ ë Œë”ë§
                    items.forEach(item => {
                        const imgUrl = item.imageUrl ? `/images/${item.imageUrl}` : 'https://dummyimage.com/600x400/dee2e6/6c757d.jpg';
                        
                        const html = `
                            <div class="col">
                                <div class="card h-100 shadow-sm border-0" onclick="location.href='/item-detail.html?id=${item.id}'" style="cursor:pointer;">
                                    <img src="${imgUrl}" class="card-img-top" alt="${item.name}" style="height: 200px; object-fit: cover;">
                                    <div class="card-body">
                                        <h5 class="card-title fw-bold text-truncate">${item.name}</h5>
                                        <p class="card-text text-danger fw-bold">${item.price.toLocaleString()}ì›</p>
                                    </div>
                                </div>
                            </div>
                        `;
                        container.insertAdjacentHTML('beforeend', html);
                    });
                })
                .catch(err => {
                    console.error("Error:", err);
                    document.getElementById('search-result-list').innerHTML = '<p class="text-danger">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.</p>';
                });
        }
    </script>
</body>
</html>