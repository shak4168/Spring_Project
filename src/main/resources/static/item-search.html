<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ê²€ìƒ‰ ê²°ê³¼ - Cloud Shop</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">
        <div class="container">
            <a class="navbar-brand fw-bold" href="/"><i class="bi bi-shop"></i> Cloud Shop</a>
            </div>
    </nav>

    <div class="container mt-5">
        <h2 class="fw-bold mb-4">
            ğŸ” "<span id="keyword-title" class="text-primary"></span>" ê²€ìƒ‰ ê²°ê³¼
        </h2>

        <div id="search-result-list" class="row row-cols-1 row-cols-md-3 row-cols-lg-4 g-4">
            </div>
        
        <div id="no-result" class="text-center py-5 d-none">
            <i class="bi bi-exclamation-circle fs-1 text-secondary"></i>
            <p class="mt-3 text-secondary fs-5">ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
            <a href="/" class="btn btn-outline-dark mt-2">ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            // 1. URLì—ì„œ keyword êº¼ë‚´ê¸°
            const params = new URLSearchParams(window.location.search);
            const keyword = params.get('keyword');

            if (keyword) {
                document.getElementById('keyword-title').innerText = keyword;
                loadSearchResults(keyword);
            } else {
                alert("ì˜ëª»ëœ ì ‘ê·¼ì…ë‹ˆë‹¤.");
                location.href = "/";
            }
        });

        // 2. ê²€ìƒ‰ API í˜¸ì¶œ
        function loadSearchResults(keyword) {
            fetch(`/api/items/search?keyword=${encodeURIComponent(keyword)}&size=20`)
                .then(res => res.json())
                .then(data => {
                    const container = document.getElementById('search-result-list');
                    const items = data.content;

                    if (items.length === 0) {
                        document.getElementById('no-result').classList.remove('d-none');
                        return;
                    }

                    // 3. ê²°ê³¼ ë Œë”ë§
                    items.forEach(item => {
                        const imgUrl = item.imageUrl ? `/images/${item.imageUrl}` : 'https://dummyimage.com/600x400/dee2e6/6c757d.jpg';
                        const html = `
                            <div class="col">
                                <div class="card h-100 shadow-sm border-0" onclick="location.href='/item-detail.html?id=${item.id}'" style="cursor:pointer;">
                                    <img src="${imgUrl}" class="card-img-top" alt="${item.name}" style="height: 200px; object-fit: cover;">
                                    <div class="card-body">
                                        <h5 class="card-title fw-bold text-truncate">${item.name}</h5>
                                        <p class="card-text text-danger fw-bold">${item.price.toLocaleString()}ì›</p>
                                    </div>
                                </div>
                            </div>
                        `;
                        container.insertAdjacentHTML('beforeend', html);
                    });
                })
                .catch(err => console.error("ê²€ìƒ‰ ì‹¤íŒ¨:", err));
        }
    </script>
</body>
</html>