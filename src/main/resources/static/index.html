<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Cloud Native Shop</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    
    <style>
        .hero-section {
            background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('https://images.unsplash.com/photo-1472851294608-415522f96319?ixlib=rb-4.0.3&auto=format&fit=crop&w=1600&q=80');
            background-size: cover;
            background-position: center;
            color: white;
            padding: 80px 0;
            margin-bottom: 30px;
        }

        /* â˜… ê°€ë¡œ ìŠ¤í¬ë¡¤ í•µì‹¬ CSS â˜… */
        .scrolling-wrapper {
            display: flex;
            flex-wrap: nowrap;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch; /* ëª¨ë°”ì¼ ë¶€ë“œëŸ¬ìš´ ìŠ¤í¬ë¡¤ */
            scroll-behavior: smooth;
            padding-bottom: 10px; /* ìŠ¤í¬ë¡¤ë°” ê³µê°„ í™•ë³´ */
            gap: 15px; /* ì¹´ë“œ ì‚¬ì´ ê°„ê²© */
        }

        /* ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¸°ê¸° (ì„ íƒì‚¬í•­ - ê¹”ë”í•˜ê²Œ ë³´ì´ë ¤ë©´ ì ìš©) */
        .scrolling-wrapper::-webkit-scrollbar {
            height: 8px;
        }
        .scrolling-wrapper::-webkit-scrollbar-thumb {
            background: #ccc;
            border-radius: 4px;
        }
        .scrolling-wrapper::-webkit-scrollbar-track {
            background: transparent;
        }

        .card-block {
            flex: 0 0 auto; /* ì¹´ë“œ í¬ê¸° ê³ ì • (ì¤„ì–´ë“¤ì§€ ì•ŠìŒ) */
            width: 250px;   /* ì¹´ë“œ ë„ˆë¹„ ì„¤ì • */
        }

        .card-img-top {
            height: 180px;
            object-fit: cover;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.1) !important;
            transition: all 0.2s;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            margin-top: 40px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }
        
        .view-all-btn {
            font-size: 0.9rem;
            text-decoration: none;
            color: #666;
            cursor: pointer;
        }
        .view-all-btn:hover { color: #000; }
    </style>
</head>
<body>

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">
        <div class="container">
            <a class="navbar-brand fw-bold" href="/"><i class="bi bi-shop"></i> Cloud Shop</a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <span class="nav-link text-white-50">í¬íŠ¸í´ë¦¬ì˜¤ìš© ì‡¼í•‘ëª°</span>
                    </li>
                </ul>

                <ul class="navbar-nav ms-auto align-items-center gap-2">
                    <li class="nav-item d-none" id="nav-item-add">
                        <a class="nav-link btn btn-outline-warning text-warning btn-sm px-3" href="/item-add.html">
                            <i class="bi bi-plus-lg"></i> ìƒí’ˆ ë“±ë¡
                        </a>
                    </li>
                    <li class="nav-item d-none" id="nav-cart">
                        <a class="nav-link text-white" href="/cart.html">
                            <i class="bi bi-cart4 fs-5"></i> <span>ì¥ë°”êµ¬ë‹ˆ</span>
                        </a>
                    </li>
                    <li class="nav-item d-none" id="nav-mypage">
                        <a class="nav-link text-white" href="/mypage.html">
                            <i class="bi bi-person-circle"></i> ë§ˆì´í˜ì´ì§€
                        </a>
                    </li>
                    <li class="nav-item" id="nav-login">
                        <a class="nav-link" href="/login.html">ë¡œê·¸ì¸</a>
                    </li>
                    <li class="nav-item" id="nav-join">
                        <a class="nav-link btn btn-primary text-white btn-sm px-3" href="/join.html">íšŒì›ê°€ì…</a>
                    </li>
                    <li class="nav-item d-none" id="nav-welcome">
                        <span class="nav-link text-white small" id="welcome-message"></span>
                    </li>
                    <li class="nav-item d-none" id="nav-logout">
                        <a class="nav-link text-danger small" href="#" onclick="logout()">ë¡œê·¸ì•„ì›ƒ</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="hero-section text-center">
        <div class="container">
            <h1 class="display-5 fw-bold">Cloud Native Shop</h1>
            <p class="lead">Spring Boot & AWS MSA Portfolio</p>
            
            <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="input-group input-group-lg shadow-sm">
                    <input type="text" id="searchInput" class="form-control" placeholder="ìƒí’ˆì„ ê²€ìƒ‰í•´ë³´ì„¸ìš” (ì˜ˆ: í‹°ì…”ì¸ )" onkeyup="if(window.event.keyCode==13){searchItem()}">
                    <button class="btn btn-primary px-4" type="button" onclick="searchItem()">
                        <i class="bi bi-search"></i> ê²€ìƒ‰
                    </button>
                </div>
            </div>
        </div>
        </div>
            
        </div>
    </div>

    <div class="container mb-5">
        
       <div class="section-header">
    <h4 class="fw-bold">ğŸ”¥ ì‹ ìƒí’ˆ (ì „ì²´)</h4>
    <a href="/item-search.html" class="view-all-btn">ì „ì²´ë³´ê¸° <i class="bi bi-chevron-right"></i></a>
</div>
<div class="section-header">
    <h4 class="fw-bold">ğŸ‘— íŒ¨ì…˜/ì˜ë¥˜</h4>
    <a href="/item-search.html?categoryId=1&categoryName=íŒ¨ì…˜/ì˜ë¥˜" class="view-all-btn">ì „ì²´ë³´ê¸° <i class="bi bi-chevron-right"></i></a>
</div>
<div class="section-header">
    <h4 class="fw-bold">ğŸ’» ê°€ì „/ë””ì§€í„¸</h4>
    <a href="/item-search.html?categoryId=2&categoryName=ê°€ì „/ë””ì§€í„¸" class="view-all-btn">ì „ì²´ë³´ê¸° <i class="bi bi-chevron-right"></i></a>
</div>
<div class="section-header">
    <h4 class="fw-bold">ğŸ ì‹ ì„  ì‹í’ˆ</h4>
    <a href="/item-search.html?categoryId=3&categoryName=ì‹ ì„  ì‹í’ˆ" class="view-all-btn">ì „ì²´ë³´ê¸° <i class="bi bi-chevron-right"></i></a>
</div>
        <div id="list-cat-3" class="scrolling-wrapper">
            <div class="text-center w-100 py-4"><div class="spinner-border text-secondary"></div></div>
        </div>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    // ì´ˆê¸° ì‹¤í–‰
    document.addEventListener("DOMContentLoaded", () => {
        checkLoginStatus();
        
        // ê° ì„¹ì…˜ë³„ ë°ì´í„° ë¡œë“œ (ë³‘ë ¬ ì²˜ë¦¬)
        loadItemsBySection(null, 'list-all');   // ì „ì²´ ìƒí’ˆ
        loadItemsBySection(1, 'list-cat-1');    // íŒ¨ì…˜
        loadItemsBySection(2, 'list-cat-2');    // ê°€ì „
        loadItemsBySection(3, 'list-cat-3');    // ì‹í’ˆ
    });

    // [í•µì‹¬] ì„¹ì…˜ë³„ ìƒí’ˆ ë¡œë“œ í•¨ìˆ˜ (ì¬ì‚¬ìš© ê°€ëŠ¥)
    function loadItemsBySection(categoryId, elementId) {
        // URL ìƒì„±: ì¹´í…Œê³ ë¦¬ê°€ ìˆìœ¼ë©´ categoryId íŒŒë¼ë¯¸í„° ì¶”ê°€, ì—†ìœ¼ë©´ ì „ì²´
        // size=10ìœ¼ë¡œ ì„¤ì •í•˜ì—¬ ê°€ë¡œ ìŠ¤í¬ë¡¤ì— ì ë‹¹í•œ ê°œìˆ˜ë§Œ ê°€ì ¸ì˜´
        let url = `/api/items?page=0&size=10`; 
        if (categoryId) {
            url += `&categoryId=${categoryId}`;
        }

        fetch(url)
            .then(res => {
                if(!res.ok) throw new Error('Load Failed');
                return res.json();
            })
            .then(data => {
                const container = document.getElementById(elementId);
                container.innerHTML = ""; // ë¡œë”© ìŠ¤í”¼ë„ˆ ì œê±°

                const items = data.content;

                if (items.length === 0) {
                    container.innerHTML = '<div class="text-muted py-4 ps-2">ë“±ë¡ëœ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                    return;
                }

                items.forEach(item => {
                    const imgUrl = item.imageUrl ? `/images/${item.imageUrl}` : 'https://dummyimage.com/600x400/dee2e6/6c757d.jpg';
                    const detailUrl = `/item-detail.html?id=${item.id}`; 

                    // ì¹´ë“œ HTML ìƒì„± (ê°€ë¡œ ìŠ¤í¬ë¡¤ìš© í´ë˜ìŠ¤ card-block ì ìš©)
                    const html = `
                        <div class="card card-block border-0 shadow-sm product-card" onclick="location.href='${detailUrl}'" style="cursor: pointer;">
                            <img src="${imgUrl}" class="card-img-top rounded" alt="${item.name}">
                            <div class="card-body p-3">
                                <h6 class="card-title fw-bold text-truncate">${item.name}</h6>
                                <p class="card-text text-danger fw-bold mb-1">${item.price.toLocaleString()}ì›</p>
                            </div>
                        </div>
                    `;
                    container.insertAdjacentHTML('beforeend', html);
                });
            })
            .catch(err => {
                console.error(err);
                document.getElementById(elementId).innerHTML = '<div class="text-danger p-3">ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨</div>';
            });
    }

    // [UI] ë¡œê·¸ì¸ ìƒíƒœ ì²´í¬
    function checkLoginStatus() {
        const token = localStorage.getItem('accessToken');
        if (token) {
            document.getElementById('nav-login').classList.add('d-none');
            document.getElementById('nav-join').classList.add('d-none');
            
            document.getElementById('nav-welcome').classList.remove('d-none');
            document.getElementById('nav-cart').classList.remove('d-none');
            document.getElementById('nav-mypage').classList.remove('d-none');
            document.getElementById('nav-logout').classList.remove('d-none');
            
            const userName = localStorage.getItem('userName');
            if (userName) document.getElementById('welcome-message').innerText = `${userName}ë‹˜`;

            const role = localStorage.getItem('role'); 
            if (role === 'SELLER' || role === 'ROLE_SELLER' || role === 'ADMIN' || role === 'ROLE_ADMIN') {
                document.getElementById('nav-item-add').classList.remove('d-none');
            }
        }
    }

    // [ê¸°ëŠ¥] ë¡œê·¸ì•„ì›ƒ
    function logout() {
        if(confirm("ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
            localStorage.clear();
            window.location.href = '/';
        }
    }
    
 // [ê¸°ëŠ¥] ê²€ìƒ‰ ì´ë™ í•¨ìˆ˜
    function searchItem() {
        const keyword = document.getElementById('searchInput').value;
        if (!keyword.trim()) {
            alert("ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!");
            return;
        }
        // ê²€ìƒ‰ í˜ì´ì§€ë¡œ í‚¤ì›Œë“œë¥¼ ë“¤ê³  ì´ë™
        location.href = `/item-search.html?keyword=${encodeURIComponent(keyword)}`;
    }
    </script>
</body>
</html>