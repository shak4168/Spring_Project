<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>관리자 - 상품 등록</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container mt-5" style="max-width: 600px;">
    <div class="card shadow">
        <div class="card-header bg-primary text-white">
            <h4 class="mb-0">상품 등록 (관리자용)</h4>
        </div>
        <div class="card-body">
            <form id="itemForm">
                <div class="mb-3">
                    <label for="name" class="form-label">상품명</label>
                    <input type="text" class="form-control" id="name" name="name" required>
                </div>

                <div class="mb-3">
                    <label for="price" class="form-label">가격</label>
                    <input type="number" class="form-control" id="price" name="price" required>
                </div>

                <div class="mb-3">
                    <label for="stockQuantity" class="form-label">재고 수량</label>
                    <input type="number" class="form-control" id="stockQuantity" name="stockQuantity" required>
                </div>

                <div class="mb-3">
                    <label for="categoryId" class="form-label">카테고리</label>
                    <select class="form-select" id="categoryId" name="categoryId" required>
                        <option value="">카테고리를 선택하세요</option>
                        </select>
                </div>

                <div class="mb-3">
                    <label for="description" class="form-label">상품 설명</label>
                    <textarea class="form-control" id="description" name="description" rows="3"></textarea>
                </div>

                <div class="mb-3">
                    <label for="imageFile" class="form-label">상품 이미지</label>
                    <input type="file" class="form-control" id="imageFile" name="imageFile">
                </div>

                <button type="submit" class="btn btn-primary w-100">등록하기</button>
            </form>
        </div>
    </div>
</div>

<script>
    // 1. 페이지 로드 시 카테고리 목록 불러오기
    document.addEventListener("DOMContentLoaded", () => {
        loadCategories();
    });

    function loadCategories() {
        fetch('/api/categories')
            .then(res => res.json())
            .then(categories => {
                const selectBox = document.getElementById('categoryId');
                
             // [수정된 코드] 자식 카테고리만 보여주거나, "부모 > 자식" 형태로 표시
                categories.forEach(category => {
                    // 1. 보여줄 텍스트 결정
                    let displayName = category.name;
                    
                    // 만약 백엔드 DTO에 parentName 같은 정보가 있다면 "패션 > 상의" 처럼 만들기 가능
                    // 현재는 간단하게 모든 카테고리를 나열
                    
                    const option = document.createElement('option');
                    option.value = category.id;
                    option.textContent = displayName;
                    selectBox.appendChild(option);
                });
            })
            .catch(err => console.error("카테고리 로딩 실패:", err));
    }

    // 2. 상품 등록 로직 (기존과 동일)
    document.getElementById('itemForm').addEventListener('submit', function(event) {
        event.preventDefault(); 

        const formData = new FormData(this);
        const token = localStorage.getItem('accessToken'); 

        if (!token) {
            alert("로그인이 필요합니다.");
            window.location.href = "/login.html";
            return;
        }

        fetch('/api/items', {
            method: 'POST',
            headers: {
                'Authorization': 'Bearer ' + token
            },
            body: formData 
        })
        .then(response => {
            if (response.ok) {
                return response.text();
            }
            throw new Error('등록 실패');
        })
        .then(data => {
            alert(data); 
            window.location.href = "/";
        })
        .catch(error => {
            console.error('Error:', error);
            alert('상품 등록 중 오류가 발생했습니다. ' + error.message);
        });
    });
</script>

</body>
</html>