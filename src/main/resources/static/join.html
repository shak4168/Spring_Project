<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>íšŒì›ê°€ì… - Cloud Shop</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .container { max-width: 600px; margin-top: 50px; }
    </style>
</head>
<body class="bg-light py-5">
    <div class="container">
        <div class="card shadow border-0">
            <div class="card-body p-5">
                <h3 class="text-center mb-4 fw-bold">íšŒì›ê°€ì…</h3>
                
                <h6 class="text-muted border-bottom pb-2 mb-3">í•„ìˆ˜ ì •ë³´</h6>
                
                <div class="mb-3">
                    <label class="form-label">ì´ë©”ì¼ (ì•„ì´ë””ë¡œ ì‚¬ìš©)</label>
                    <input type="email" id="joinEmail" class="form-control" placeholder="example@email.com">
                </div>

                <div class="mb-3">
                    <label class="form-label">ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="joinPw" class="form-control" placeholder="ì˜ë¬¸, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ì í¬í•¨ 8~20ì">
                </div>

                <div class="mb-3">
                    <label class="form-label">ì´ë¦„</label>
                    <input type="text" id="joinName" class="form-control" placeholder="í•œê¸€ 2~5ì (ì˜ˆ: í™ê¸¸ë™)">
                </div>

                <div class="mb-3">
                    <label class="form-label">ìƒë…„ì›”ì¼</label>
                    <input type="text" id="birthDate" class="form-control" maxlength="8" placeholder="ìƒë…„ì›”ì¼ 8ìë¦¬ (ì˜ˆ: 19900101)" oninput="this.value = this.value.replace(/[^0-9]/g, '')">
                </div>

                <div class="mb-3">
                    <label class="form-label">íœ´ëŒ€í° ë²ˆí˜¸</label>
                    <input type="text" id="joinPhone" class="form-control" placeholder="- ì—†ì´ ìˆ«ìë§Œ ì…ë ¥" oninput="this.value = this.value.replace(/[^0-9]/g, '')">
                </div>

                <h6 class="text-muted border-bottom pb-2 mb-3 mt-4">ì£¼ì†Œ ì •ë³´ (ì„ íƒ)</h6>
                <div class="input-group mb-2">
                    <input type="text" id="zipcode" class="form-control" placeholder="ìš°í¸ë²ˆí˜¸" readonly>
                    <button class="btn btn-outline-primary" type="button" onclick="execDaumPostcode()">ì£¼ì†Œ ì°¾ê¸°</button>
                </div>
                <div class="mb-2">
                    <input type="text" id="address" class="form-control" placeholder="ê¸°ë³¸ ì£¼ì†Œ" readonly>
                </div>
                <div class="mb-4">
                    <input type="text" id="detailAddress" class="form-control" placeholder="ìƒì„¸ ì£¼ì†Œ">
                </div>
                
                <div class="mb-3">
                <label class="form-label fw-bold">ê°€ì… ìœ í˜•</label>
                    <div class="card p-3 bg-light border-0">
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="radio" name="role" id="roleUser" value="USER" checked>
                            <label class="form-check-label" for="roleUser">
                                ğŸ›’ <strong>êµ¬ë§¤ì</strong> (ìƒí’ˆì„ êµ¬ë§¤í•˜ê³  ì‹¶ì–´ìš”)
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="role" id="roleSeller" value="SELLER">
                            <label class="form-check-label" for="roleSeller">
                                ğŸ’¼ <strong>íŒë§¤ì</strong> (ë‚´ ìƒí’ˆì„ íŒë§¤í•˜ê³  ì‹¶ì–´ìš”)
                            </label>
                        </div>
                    </div>
                </div>

                <button onclick="join()" class="btn btn-primary w-100 py-2 fw-bold">ê°€ì…í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script>
        // 1. ì£¼ì†Œ ì°¾ê¸° í•¨ìˆ˜ (Daum API)
        function execDaumPostcode() {
            new daum.Postcode({
                oncomplete: function(data) {
                    var addr = data.userSelectedType === 'R' ? data.roadAddress : data.jibunAddress;
                    
                    document.getElementById('zipcode').value = data.zonecode;
                    document.getElementById("address").value = addr;
                    
                    // ìƒì„¸ì£¼ì†Œ ì»¤ì„œ ì´ë™ (ì•ˆì „ì¥ì¹˜ ì¶”ê°€)
                    var detailInput = document.getElementById("detailAddress");
                    if(detailInput) detailInput.focus();
                }
            }).open();
        }

        // 2. íšŒì›ê°€ì… ìš”ì²­ í•¨ìˆ˜
        async function join() {
            const email = document.getElementById('joinEmail').value; 
            const password = document.getElementById('joinPw').value;
            const name = document.getElementById('joinName').value;
            const birthDate = document.getElementById('birthDate').value; 
            const phone = document.getElementById('joinPhone').value;
            
            // ë¼ë””ì˜¤ ë²„íŠ¼ ì„ íƒê°’ ê°€ì ¸ì˜¤ê¸°
            const roleRadio = document.querySelector('input[name="role"]:checked');
            // ê¸°ë³¸ê°’ USER
            const role = roleRadio ? roleRadio.value : 'USER';

            // ìœ íš¨ì„± ê²€ì‚¬
            if (!email || !password || !name || !birthDate) {
                alert("í•„ìˆ˜ ì •ë³´ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
                return;
            }

            // ì •ê·œì‹ \s(ì†Œë¬¸ì:ê³µë°±) -> \S(ëŒ€ë¬¸ì:ê¸€ì) ë¡œ ìˆ˜ì •
            if (!/^\S+@\S+\.\S+$/.test(email)) {
                alert("ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.");
                return;
            }
            
            // ë°ì´í„° ì „ì†¡ ê°ì²´
            const data = {
                email: email,       
                password: password,
                name: name,
                phone: phone, 
                birthDate: birthDate, 
                // document.getElementById (ì¹´ë©œì¼€ì´ìŠ¤ í•„ìˆ˜)
                zipcode: document.getElementById('zipcode').value,
                address: document.getElementById('address').value,
                detailAddress: document.getElementById('detailAddress').value,
                role: role 
            };

            try {
                const response = await fetch('/api/members/join', {
                    method: 'POST', // ëŒ€ë¬¸ì ê¶Œì¥
                    headers: { 'Content-Type': 'application/json' }, //  ëŒ€ì†Œë¬¸ì ì¤€ìˆ˜
                    body: JSON.stringify(data) // JSON ëŒ€ë¬¸ì í•„ìˆ˜
                });
                
                if (response.ok) {
                    alert("íšŒì›ê°€ì… ì„±ê³µ! ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.");
                    window.location.href = "/login.html";
                } else {
                    alert("ê°€ì… ì‹¤íŒ¨: " + await response.text());
                }
            } catch (error) {
                console.error('Error:', error);
                alert("íšŒì›ê°€ì… ì‹¤íŒ¨: " + error.message);
            }
        }
    </script>
</body>
</html>